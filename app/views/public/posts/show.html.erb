<h2><%= @post.title %></h2>
<div class="row">
	<div class="col-xs-5">
		<%= attachment_image_tag @post, :image, format: 'jpeg', fallback: "sample.jpg", size:"450x300" %>
		<p>投稿日 <%= @post.created_at.strftime("%Y/%m/%d") %>
		   更新日 <%= @post.updated_at.strftime("%Y/%m/%d ") %></p>
	</div>
	<div class="col-xs-5">
		<p>
	        <span class="post-prefecture"><%= link_to @post.prefecture.name, posts_path(prefecture_id: @post.prefecture.id)  %></span>
			<span class="post-genre"><%= link_to @post.genre.name, posts_path(genre_id: @post.genre.id) %></span>
		</p>
		
		<%= link_to user_path(@post.user) do %>
            <%= attachment_image_tag @post.user, :image, format: 'jpeg', fallback: "no_image.jpg", size: "30x30" %>
            <%= @post.user.name %>
        <% end %>


		<p>タグ　<% @post.tags.each do |tag| %>
					#<%= link_to tag.name, posts_path(tag_id: tag.id) %>
				<% end %>
		</p>
		<p><%= @post.body %></p>
		
		<% if user_signed_in? %>
	        <p> <!-- いいね機能 -->
			    <% if @post.favorited_by?(current_user) %>
		            <%= link_to post_favorites_path(@post), method: :delete do %>
			            <span class="glyphicon glyphicon-heart fa-lg"></span>
		            <% end %>
		        <% else %>
		            <%= link_to post_favorites_path(@post), method: :post do %>
			            <span class="glyphicon glyphicon-heart-empty fa-lg"></span>
			        <% end %>
		        <% end %>
		        <%= @post.favorites.count %>
		        <span id="star-rate-#{post.id}"></span>
		        <span><i class="far fa-comment-dots fa-lg"></i><%= @post.post_comments.count %></span>
	        </p>
	    <% else %>
	        <span class="glyphicon glyphicon-heart fa-lg"><%= @post.favorites.count %></span>
	        <span><i class="far fa-comment-dots fa-lg"></i><%= @post.post_comments.count %></span>
        <% end %>
    </div>

    <div class="col-xs-2">
        <!-- ユーザーの投稿編集・削除ボタン -->
        <% if @post.user == current_user %>
	        <p><%= link_to '投稿を編集する', edit_post_path(@post) %><br>
	        <%= link_to '投稿を削除する', @post, method: :delete, data: { confirm: '本当に消しますか？' } %></p>
	    <% end %>
	</div>

</div>


<!-- コメントフォーム -->
<% if user_signed_in? %>
	<div class="row">
		<h4>コメント入力欄</h4>
		<%= form_for [@post, @post_comment] do |f| %>
		    <%= f.text_area :comment, size: "90x5" %>

		    <div id=star>
			    <%= f.hidden_field :rate, id: :post_comment_rate %>
		    </div>

		    <%= f.submit '送信' %>
		<% end %>
	</div>
<% end %>

<!-- コメント一覧 -->
<% if @post_comments.exists? %>
	<div class="row">
		<h4>コメント一覧</h4>
		<table class="col-xs-12">
			<thead>
				<tr>
					<td></td>
					<td><i class="far fa-star fa-lg"></i></td>
					<td><i class="far fa-comment-dots fa-lg"></i></td>
					<td>コメント日</td>
			<tbody>
	        <% @post_comments.each do |post_comment| %>
		        <tr>
		            <td>
			            <%= link_to user_path(post_comment.user) do %>
				            <%= attachment_image_tag post_comment.user, :image, format: 'jpeg', fallback: "no_image.jpg", size: "30x30" %><br>
			                <%= post_comment.user.name %>
		                <% end %>
		            </td>
		            <td class="star-rate-<%= post_comment.id %>">
		            	<%= post_comment.rate %>
		            </td>
			        <td><%= post_comment.comment %></td>
			        <td><%= post_comment.created_at.strftime("%Y/%m/%d") %></td>
			        <!--コメント削除 -->
			        <% if post_comment.user == current_user %>
			        <td>
				        <%= link_to 'コメント（評価）を削除する', post_post_comment_path(post_comment.post, post_comment ), method: :delete %>
				        <% end %>
				    </td>
		        </tr>
		    <% end %>
			</tbody>
	    </table>
	</div>
<% end %>

